<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/principal" mode="md"></ion-back-button>
    </ion-buttons>
    <ion-title>Menú Semanal</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="saveToHistory()" class="header-btn">
        <ion-icon slot="icon-only" name="save-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="goToHistory()" class="header-btn">
        <ion-icon slot="icon-only" name="list-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="initSchedule()" class="header-btn">
        <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="main-wrapper">
    <header class="hero-section">
      <h1 class="main-phrase">Planifica tu semana</h1>
      <p class="greeting-tagline">Organiza tus comidas con estilo</p>
    </header>

    <div class="planner-container" cdkDropListGroup>
      <div class="grid-header animate-up">
        <div class="day-col">Día</div>
        <div class="type-col">
          <ion-icon name="sunny-outline"></ion-icon> Almuerzo
        </div>
        <div class="type-col">
          <ion-icon name="moon-outline"></ion-icon> Cena
        </div>
      </div>

      <div class="days-list">
        <div *ngFor="let day of fullDayNames; let dIdx = index" class="day-row animate-up"
          [style.animation-delay]="(dIdx * 0.05) + 's'">

          <div class="day-indicator">
            <span class="day-initial">{{ days[dIdx] }}</span>
            <span class="day-full">{{ day }}</span>
          </div>

          <!-- Almuerzo Slot -->
          <div class="organic-slot lunch" cdkDropList [cdkDropListData]="schedule[dIdx][0]"
            (cdkDropListDropped)="drop($event)">
            <div class="curvy-postit lunch-theme" *ngFor="let item of schedule[dIdx][0]" cdkDrag>
              <textarea [(ngModel)]="item.text" placeholder="Escribe aquí..." (ngModelChange)="saveSchedule()">
              </textarea>
              <div class="drag-handle" cdkDragHandle>
                <ion-icon name="grid-outline"></ion-icon>
              </div>
              <!-- Preview while dragging -->
              <div *cdkDragPlaceholder class="cdk-drag-placeholder"></div>
            </div>
          </div>

          <!-- Cena Slot -->
          <div class="organic-slot dinner" cdkDropList [cdkDropListData]="schedule[dIdx][1]"
            (cdkDropListDropped)="drop($event)">
            <div class="curvy-postit dinner-theme" *ngFor="let item of schedule[dIdx][1]" cdkDrag>
              <textarea [(ngModel)]="item.text" placeholder="Escribe aquí..." (ngModelChange)="saveSchedule()">
              </textarea>
              <div class="drag-handle" cdkDragHandle>
                <ion-icon name="grid-outline"></ion-icon>
              </div>
              <div *cdkDragPlaceholder class="cdk-drag-placeholder"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>
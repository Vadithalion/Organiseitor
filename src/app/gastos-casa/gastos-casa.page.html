<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/principal" mode="md"></ion-back-button>
    </ion-buttons>
    <ion-title>Balance Casa</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="showInfo()" class="info-btn">
        <ion-icon slot="icon-only" name="information-circle-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="openAddModal()" class="header-btn">
        <ion-icon slot="icon-only" name="add-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <div class="segment-container">
    <ion-segment [value]="selectedTab()" (ionChange)="setTab($event)" mode="ios">
      <ion-segment-button value="gastos">
        <ion-label>Gastos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="ingresos">
        <ion-label>Ingresos</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="main-wrapper">
    <div class="summary-card glass-panel" [class.income-theme]="selectedTab() === 'ingresos'">
      <div class="summary-info">
        <span class="summary-label">{{ summaryTitle() }}</span>
        <h1 class="summary-value">{{ totalAmount() | currency:'EUR' }}</h1>
      </div>
      <div class="summary-blob"></div>
    </div>

    <div class="filters-panel glass-panel">
      <div class="organic-filters">
        <div class="filter-box">
          <label class="filter-label">Categoría</label>
          <ion-input [value]="filterCategory()" placeholder="Filtro..." (ionInput)="updateCategory($event)"
            class="organic-input"></ion-input>
        </div>
        <div class="filter-box">
          <label class="filter-label">Fecha</label>
          <ion-input type="date" [value]="filterDate()" (ionChange)="updateDate($event)"
            class="organic-input"></ion-input>
        </div>
      </div>
    </div>

    <div class="table-section">
      <div class="table-card glass-panel">
        <div class="table-row header-row">
          <div class="col-date">Fecha</div>
          <div class="col-desc">Descripción</div>
          <div class="col-amount">Importe</div>
        </div>

        <ion-list lines="none" class="transparent-list">
          <ion-item-sliding *ngFor="let item of filteredItems(); let i = index" class="animate-up"
            [style.animation-delay]="(i * 0.05) + 's'">
            <ion-item class="table-item-row">
              <div class="row-content">
                <div class="col-date">{{ item.fecha | date:'dd/MM' }}</div>
                <div class="col-desc">
                  <span class="main-desc">{{ item.descripcion }}</span>
                  <span class="sub-cat">{{ item.categoria }}</span>
                </div>
                <div class="col-amount" [class.is-income]="selectedTab() === 'ingresos'">
                  {{ item.cantidad | currency:'EUR' }}
                </div>
              </div>
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option color="danger" (click)="deleteItem(item.id)" class="curvy-option">
                <ion-icon name="trash" slot="icon-only"></ion-icon>
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-list>

        <div *ngIf="filteredItems().length === 0" class="empty-msg">
          <ion-icon name="search-outline"></ion-icon>
          <p>Sin datos</p>
        </div>
      </div>
    </div>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openAddModal()" [color]="selectedTab() === 'gastos' ? 'primary' : 'success'"
      class="add-fab">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Add Modal -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()" [initialBreakpoint]="0.75"
    [breakpoints]="[0, 0.75, 0.95]">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar>
          <ion-title>Nuevo {{ selectedTab() === 'gastos' ? 'Gasto' : 'Ingreso' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <div class="add-form">
          <ion-item class="input-item" lines="none">
            <ion-input label="Descripción" labelPlacement="stacked" [(ngModel)]="newItem.descripcion"
              placeholder="Ej: Supermercado"></ion-input>
          </ion-item>
          <ion-item class="input-item" lines="none">
            <ion-input label="Categoría" labelPlacement="stacked" [(ngModel)]="newItem.categoria"
              placeholder="Ej: Comida"></ion-input>
          </ion-item>
          <ion-row>
            <ion-col size="6">
              <ion-item class="input-item" lines="none">
                <ion-input label="Importe (€)" labelPlacement="stacked" type="number"
                  [(ngModel)]="newItem.cantidad"></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="6">
              <ion-item class="input-item" lines="none">
                <ion-input label="Fecha" labelPlacement="stacked" type="date" [(ngModel)]="newItem.fecha"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-button expand="block" (click)="saveItem()" class="add-btn ion-margin-top"
            [disabled]="!newItem.descripcion || !newItem.categoria || !newItem.cantidad">
            <ion-icon name="save-outline" slot="start"></ion-icon>
            Guardar
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>